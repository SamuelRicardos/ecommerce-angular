<!-- HEADER -->
<mat-toolbar color="primary" class="header-toolbar">
  <span class="mat-headline-small header-title">
    <mat-icon>storefront</mat-icon> ShopPrime
  </span>
  <span class="spacer"></span>

</mat-toolbar>

<!-- MAIN -->
<main class="main-container">
  <h1 class="mat-headline-medium title-main">Gerenciar Produtos</h1>

  <!-- FORMULÁRIO -->
  <form (ngSubmit)="salvarProduto()" class="produto-form">
    <mat-card>
      <mat-card-content>
        <mat-form-field appearance="outline">
          <mat-label>Nome do Produto</mat-label>
          <input matInput [(ngModel)]="produtoAtual.nome" name="nome" required />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Categorias</mat-label>
          <mat-select [(ngModel)]="produtoAtual.categorias" name="categorias" multiple>
            <mat-option *ngFor="let categoria of todasCategorias" [value]="categoria">
              {{ categoria }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Preço</mat-label>
          <input matInput type="number" step="0.01" [(ngModel)]="produtoAtual.preco" name="preco" required />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Quantidade em estoque</mat-label>
          <input matInput type="number" [(ngModel)]="produtoAtual.quantidadeEstoque" name="quantidadeEstoque"
            required />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Imagem (URL)</mat-label>
          <input matInput type="url" [(ngModel)]="produtoAtual.imagemUrl" name="imagemUrl" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Descrição do Produto</mat-label>
          <textarea matInput rows="4" [(ngModel)]="produtoAtual.descricao" name="descricao"></textarea>
        </mat-form-field>
      </mat-card-content>



      <mat-card-actions align="end">
        <button mat-flat-button color="primary" type="submit">
          {{ editando ? 'Atualizar' : 'Cadastrar' }}
        </button>
        <button mat-stroked-button type="button" (click)="resetarFormulario()" class="botao-cancelar">
          Cancelar
        </button>
      </mat-card-actions>
    </mat-card>
  </form>

  <!-- LISTAGEM -->
  <section class="produtos-list">
    <h2 class="mat-title">Produtos cadastrados</h2>
    <mat-divider></mat-divider>

    <table mat-table [dataSource]="produtos" class="mat-elevation-z1" style="width: 100%; margin-top: 16px;">

      <ng-container matColumnDef="imagem">
        <th mat-header-cell *matHeaderCellDef> Imagem </th>
        <td mat-cell *matCellDef="let p">
          <div class="imagem-wrapper">
            <img *ngIf="p.imagemUrl" [src]="p.imagemUrl" alt="{{ p.nome }}" class="imagem-produto" />
            <span *ngIf="!p.imagemUrl" class="mat-caption">Sem imagem</span>
          </div>
        </td>
      </ng-container>
      <!-- colunas aqui como você já tinha -->
      <ng-container matColumnDef="nomeCodigo">
        <th mat-header-cell *matHeaderCellDef> Nome do produto </th>
        <td mat-cell *matCellDef="let p"> {{ p.nome }} </td>
      </ng-container>

      <ng-container matColumnDef="categorias">
        <th mat-header-cell *matHeaderCellDef> Categorias </th>
        <td mat-cell *matCellDef="let p"> {{ p.categorias }} </td>
      </ng-container>

      <ng-container matColumnDef="quantidadeEstoque">
        <th mat-header-cell *matHeaderCellDef> Quantidade </th>
        <td mat-cell *matCellDef="let p"> {{ p.quantidadeEstoque }} </td>
      </ng-container>

      <ng-container matColumnDef="preco">
        <th mat-header-cell *matHeaderCellDef> Preço </th>
        <td mat-cell *matCellDef="let p"> R$ {{ p.preco }} </td>
      </ng-container>



      <ng-container matColumnDef="acoes">
        <th mat-header-cell *matHeaderCellDef style="text-align: center;"> Ações </th>
        <td mat-cell *matCellDef="let p" style="text-align: center;">
          <button mat-icon-button color="primary" (click)="editarProduto(p)" aria-label="Editar">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deletarProduto(p.id)" aria-label="Remover">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>


      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons aria-label="Select page of products">
    </mat-paginator>
  </section>
</main>

<!-- FOOTER -->
<mat-toolbar color="primary" role="contentinfo" class="footer-toolbar">
  <div>
    <p class="mat-caption">&copy; 2025 ShopPrime. Todos os direitos reservados.</p>
  </div>
</mat-toolbar>